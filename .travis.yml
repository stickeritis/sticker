language: rust
dist: xenial
env:
  global:
  - PROJECT_NAME: sticker
addons:
  apt:
    packages:
    - patchelf
matrix:
  fast_finish: true
  include:
  - os: linux
    rust: stable
    env: TARGET=x86_64-unknown-linux-gnu
  - os: osx
    rust: stable
    env: TARGET=x86_64-apple-darwin
  - os: linux
    rust: 1.34.0
    env: TARGET=x86_64-unknown-linux-gnu
  - os: linux
    rust: nightly
    env: TARGET=x86_64-unknown-linux-gnu
  allow_failures:
  - rust: nightly
before_script:
- rustup component add clippy
- rustup component add rustfmt
script: ci/script.sh
before_deploy: ci/before_deploy.sh
deploy:
  provider: releases
  api_key:
    secure: ED+coeBzeejeEMZLMAZlhmLTdlNjo8R2PcILmpRN6/J4e2c65YkmW/xvZFhCsX5enNVKwQwF9DAA0l5KOInZMk9Pgx5qmWDgzxQBUMHl0HCI+U+0xOhye9SYTy1GSvumdGAfoSewf9Pbs7jWSy9GWCaJ+e2rParS71G/MyosKz8ZN72z1CaCO9i7uWs9XTGrp1z4K8pSPAZfNRnKn6So8BijKGfZkrK7s0u7tH26CEcXOfgr3A1k9oumr5NKSFf6b4Avvhc25nkQqVSLF7LRVVwjlIUREGoUgAWk14zWtW/RL1UotRg1Vp3pZvdc/MsKGWACvANxQWx2FKdTQZE4dgO90oltzZZ3yoKfogDddZBRNvyhR55l46iEFTyimq7bsoRKlMwkhUOQ+2u33JxorHxIX9kq+8hys5XlDLs+Fp7GGAV2HMO4TWGqRFy5NzM1aNt4T98DwL0yb+vxXyCTYxih0782CImDpE7+7o013b4zOnlKBELy9kTr4rmUVrDQtAErC+qJI47gdZOBQdHs/2GTQBULlNxcTrjRtVrGoHuCYbYz92nFIbzmfswbilmAP1rtV1FyxWcjjX1WaOsLbfK8inRFmumaVMfnpK6e9TGywunL2gNa5+VUYudKK+X9xKcYJSHXkybXE2vZAnbvdgRycEXNwHyfIdrkRREc+XU=
  file_glob: true
  file: deployment/${PROJECT_NAME}-${TRAVIS_TAG}-${TARGET}.tar.gz
  skip_cleanup: true
  on:
    condition: $TRAVIS_RUST_VERSION = stable
    repo: danieldk/sticker
    tags: true
